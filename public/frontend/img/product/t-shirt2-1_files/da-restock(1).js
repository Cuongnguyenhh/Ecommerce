const getUrlParameterByNameInExtension=name=>{const url=window.location.href;name=name.replace(/[\[\]]/g,"\\$&");const results=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)").exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null},shouldExcludeRelatedProductsSectionExtension=element=>!!(element.closest(".related-products-product-template")||element.closest(".recommended-products-section")||element.closest(".shopify-section-template--product--recommendations")||element.closest("#ga-product_related")||element.closest("#ga-product_bought_together")||element.closest(".product-recommendations"));class ProductAppExtension{initDaRestock(){const alwaysShow=Array.from(document.querySelectorAll(".da-restock-alerts-alwaysShow")).filter((alwaysShowElement=>!shouldExcludeRelatedProductsSectionExtension(alwaysShowElement)));document.querySelector(".da-restock-alerts-form-container")&&!alwaysShow.length&&(this.initChangeHandler(),this.changeHandler()),this.initForm(),this.handleUrlParamResponse()}initChangeHandler(){document.querySelectorAll("select").forEach((selectDropDown=>{selectDropDown.addEventListener("change",(e=>{setTimeout(this.changeHandler,500)}))})),document.querySelectorAll("input[type=radio]").forEach((radioInputs=>{radioInputs.addEventListener("change",(e=>{setTimeout(this.changeHandler,500)}))})),document.addEventListener("click",(e=>{setTimeout(this.changeHandler,500)})),document.querySelectorAll("button").forEach((buttons=>{buttons.addEventListener("click",(e=>{setTimeout(this.changeHandler,500)}))})),document.querySelectorAll("a").forEach((anchor=>{anchor.addEventListener("click",(e=>{setTimeout(this.changeHandler,500)}))}))}changeHandler(){let variant=null;const thankYouDiv=document.querySelector(".da-restock-alerts-msg-success-v1");if(thankYouDiv&&"inline-block"===thankYouDiv.style.display)return;const selectDisabled=null!==document.querySelector("select[name=id] option:disabled"),formVariantId=document.querySelector("input.formVariantId[name=id]"),productIdSelectedOption=document.querySelector("select[name=id] option:checked"),productIdInput=document.querySelector("input[name=id]"),variantParam=getUrlParameterByNameInExtension("variant");formVariantId&&formVariantId.value&&!shouldExcludeRelatedProductsSectionExtension(formVariantId)?variant=formVariantId.value:selectDisabled||!productIdSelectedOption||!productIdSelectedOption.value||shouldExcludeRelatedProductsSectionExtension(productIdSelectedOption)||productIdSelectedOption.closest("#nudge-offer")?variantParam?variant=variantParam:productIdInput&&productIdInput.value&&!shouldExcludeRelatedProductsSectionExtension(productIdInput)?variant=productIdInput.value:"undefined"!=typeof da_variant_v1&&(variant=da_variant_v1):variant=productIdSelectedOption.value,variant=variant?variant.toString():variant;const setValue=document.querySelector(".da-restock-alerts-container-v1").getAttribute("data-daeligiblevariants").split(",").includes(variant)?variant:null,container=document.querySelector(".da-restock-alerts-container-v1");container.style.display=setValue?"block":"none";document.querySelector('input[name="da-restock-alerts-variant"').value=setValue}initForm(){document.querySelectorAll("div.da-restock-notification form, .da-restock-image form.da-restock-form").forEach((form=>{form.action=""})),document.querySelectorAll("div.da-restock-notification form, .da-restock-image form.da-restock-form").forEach((form=>{form.addEventListener("submit",(e=>{e.preventDefault()}))})),document.querySelectorAll("div.da-price-notification-form input").forEach((emailInput=>{emailInput.addEventListener("change",(()=>{document.querySelectorAll("#dd-price-notification-msg, #dd-price-notification-msg-error").forEach((msg=>{msg.style.display="none"}))}))})),document.querySelectorAll("div.da-restock-alerts-form .da-restock-alerts-form-button").forEach((button=>{button.addEventListener("click",(e=>this.createFormHandler(e)))})),document.querySelectorAll("div.da-restock-alerts-form input").forEach((input=>{input.addEventListener("keypress",(e=>{if(13===e.keyCode){const siblings=input.parentNode.children;for(const sib of siblings)sib.classList.contains("da-restock-notification-button")&&sib.click()}}))}))}createFormHandler(e){e.preventDefault(),e.stopPropagation();const button=e.target||e.srcElement,form=button.closest(".da-restock-alerts-form");button&&button.removeEventListener("click",this.createFormHandler),this.combinedFormHandler(form)}combinedFormHandler(form){var _form$querySelector,_form$querySelector2;const email=null===(_form$querySelector=form.querySelector("input[name=email]"))||void 0===_form$querySelector?void 0:_form$querySelector.value,sms=null===(_form$querySelector2=form.querySelector("input[name=sms]"))||void 0===_form$querySelector2?void 0:_form$querySelector2.value,parentContainer=form.closest(".da-restock-alerts-container-v1"),validEmail=email&&(email=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email))(email);if(validEmail||!!sms){parentContainer.querySelector(".da-restock-alerts-msg-success-v1, .da-restock-alerts-msg-error-v1").display="none";const data={email:form.querySelector("input[name=email]")?form.querySelector("input[name=email]").value:"",sms:form.querySelector("input[name=sms]")?form.querySelector("input[name=sms]").value:"",store:form.querySelector("input[name=store]")?form.querySelector("input[name=store]").value:"",product:form.querySelector("input[name=product]")?form.querySelector("input[name=product]").value:"",variant:form.querySelector("[name=da-restock-alerts-variant]")?form.querySelector("[name=da-restock-alerts-variant]").value:"",url:form.querySelector("input[name=url]")?form.querySelector("input[name=url]").value:"",ajax:"true",firstName:form.querySelector("input[name=firstName]")?form.querySelector("input[name=firstName]").value:"",lastName:form.querySelector("input[name=lastName]")?form.querySelector("input[name=lastName]").value:"",daAcceptsMarketing:form.querySelector("input[name=daAcceptsMarketing]")?form.querySelector("input[name=daAcceptsMarketing]").value:""};window.fetch("https://alertmerestockalerts.herokuapp.com/addemail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}).then((response=>{if(!response.ok)throw Error(response.statusText);parentContainer.querySelector(".da-restock-alerts-msg-error-v1").style.display="none",parentContainer.querySelector(".da-restock-alerts-msg-success-v1").style.display="inline-block",form.closest(".da-restock-alerts-form-container").style.display="none"})).catch((error=>{parentContainer.querySelector(".da-restock-alerts-msg-error-v1").style.display="inline-block"}))}else parentContainer.querySelector(".da-restock-alerts-msg-error-v1").style.display="inline-block"}handleUrlParamResponse(){const param=getUrlParameterByNameInExtension("restocknotify");"success"===param?(document.querySelector(".da-restock-alerts-form-container").style.display="none",document.querySelector(".da-restock-alerts-msg-success-v1")&&(document.querySelector(".da-restock-alerts-msg-success-v1").style.display="block",document.querySelector(".da-restock-alerts-msg-error-v1").style.display="none")):"error"===param&&(document.querySelector(".da-restock-alerts-msg-success-v1").style.display="none",document.querySelector(".da-restock-alerts-msg-error-v1").style.display="block")}}if(document.querySelector(".da-restock-alerts-container-v1")){(new ProductAppExtension).initDaRestock()}else{const daRestockProductFormAppExtension=new ProductAppExtension;document.addEventListener("DOMContentLoaded",(()=>{daRestockProductFormAppExtension.initDaRestock()})),MutationObserver=window.MutationObserver||window.WebKitMutationObserver;var obs=new MutationObserver((mutations=>{let added=!1;for(var i=0;i<mutations.length;++i)for(var j=0;j<mutations[i].addedNodes.length;++j)mutations[i].addedNodes[j].classList&&mutations[i].addedNodes[j].innerHTML.includes("da-restock-alerts-form-container")&&(added=!0);added&&daRestockProductFormAppExtension.initDaRestock()})),container=document.documentElement||document.body;obs.observe(container,{childList:!0,subtree:!0})}
